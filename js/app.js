const animals1 = [
    { 1: "C", 2: "A", 3: "T" },
    { 1: "D", 2: "O", 3: "G" },
    { 1: "F", 2: "O", 3: "X" },
    { 1: "P", 2: "I", 3: "G" },
    { 1: "B", 2: "A", 3: "T" },
    { 1: "O", 2: "W", 3: "L" },
    { 1: "E", 2: "L", 3: "K" },
    { 1: "C", 2: "O", 3: "W" },
    { 1: "R", 2: "A", 3: "T" },
    { 1: "A", 2: "P", 3: "E" },
    { 1: "H", 2: "E", 3: "N" },
    { 1: "A", 2: "N", 3: "T" },
    { 1: "B", 2: "E", 3: "E" },
    { 1: "C", 2: "U", 3: "B" },
    { 1: "E", 2: "E", 3: "L" },
    { 1: "Y", 2: "A", 3: "K" },
    { 1: "H", 2: "O", 3: "G" },
];

const animals2 = [
    { 1: "L", 2: "I", 3: "O", 4: "N" },
    { 1: "W", 2: "O", 3: "L", 4: "F" },
    { 1: "F", 2: "R", 3: "O", 4: "G" },
    { 1: "B", 2: "E", 3: "A", 4: "R" },
    { 1: "C", 2: "R", 3: "A", 4: "B" },
    { 1: "S", 2: "W", 3: "A", 4: "N" },
    { 1: "D", 2: "E", 3: "E", 4: "R" },
    { 1: "C", 2: "O", 3: "L", 4: "T" },
    { 1: "M", 2: "O", 3: "L", 4: "E" },
    { 1: "P", 2: "O", 3: "N", 4: "Y" },
    { 1: "F", 2: "I", 3: "S", 4: "H" },
    { 1: "H", 2: "A", 3: "R", 4: "E" },
    { 1: "D", 2: "O", 3: "V", 4: "E" },
    { 1: "L", 2: "A", 3: "R", 4: "K" },
    { 1: "P", 2: "I", 3: "K", 4: "A" },
    { 1: "T", 2: "O", 3: "A", 4: "D" },
    { 1: "M", 2: "I", 3: "N", 4: "K" },
    { 1: "D", 2: "U", 3: "C", 4: "K" },
    { 1: "T", 2: "U", 3: "N", 4: "A" },
];

const animals3 = [
    { 1: "T", 2: "I", 3: "G", 4: "E", 5: "R" },
    { 1: "Z", 2: "E", 3: "B", 4: "R", 5: "A" },
    { 1: "S", 2: "H", 3: "A", 4: "R", 5: "K" },
    { 1: "M", 2: "O", 3: "U", 4: "S", 5: "E" },
    { 1: "E", 2: "A", 3: "G", 4: "L", 5: "E" },
    { 1: "L", 2: "E", 3: "M", 4: "U", 5: "R" },
    { 1: "S", 2: "Q", 3: "U", 4: "I", 5: "D" },
    { 1: "C", 2: "O", 3: "R", 4: "A", 5: "L" },
    { 1: "H", 2: "Y", 3: "E", 4: "N", 5: "A" },
    { 1: "P", 2: "I", 3: "G", 4: "E", 5: "O" },
    { 1: "P", 2: "A", 3: "N", 4: "D", 5: "A" },
    { 1: "W", 2: "H", 3: "A", 4: "L", 5: "E" },
    { 1: "O", 2: "T", 3: "T", 4: "E", 5: "R" },
    { 1: "S", 2: "L", 3: "O", 4: "T", 5: "H" },
    { 1: "S", 2: "N", 3: "A", 4: "I", 5: "L" },
    { 1: "R", 2: "A", 3: "V", 4: "E", 5: "N" },
    { 1: "H", 2: "O", 3: "R", 4: "S", 5: "E" },
    { 1: "E", 2: "L", 3: "A", 4: "N", 5: "D" },
    { 1: "N", 2: "A", 3: "N", 4: "D", 5: "U" },
    { 1: "S", 2: "K", 3: "U", 4: "N", 5: "K" },
];

const names1 = [
    { 1: "A", 2: "L", 3: "I" },
    { 1: "S", 2: "A", 3: "M" },
    { 1: "A", 2: "L", 3: "A" },
    { 1: "A", 2: "Y", 3: "A" },
    { 1: "J", 2: "A", 3: "D" },
    { 1: "A", 2: "D", 3: "I" },
    { 1: "M", 2: "A", 3: "X" },
    { 1: "B", 2: "E", 3: "N" },
    { 1: "L", 2: "E", 3: "O" },
    { 1: "J", 2: "A", 3: "Y" },
    { 1: "T", 2: "O", 3: "M" },
    { 1: "K", 2: "I", 3: "M" },
    { 1: "B", 2: "O", 3: "B" },
    { 1: "T", 2: "E", 3: "D" },
    { 1: "N", 2: "E", 3: "D" },
    { 1: "J", 2: "A", 3: "N" },
    { 1: "F", 2: "A", 3: "Y" },
    { 1: "M", 2: "I", 3: "A" },
    { 1: "N", 2: "I", 3: "A" },
    { 1: "M", 2: "A", 3: "I" }
];

const names2 = [
    { 1: "Z", 2: "A", 3: "I", 4: "N" },
    { 1: "R", 2: "A", 3: "M", 4: "I" },
    { 1: "H", 2: "A", 3: "D", 4: "I" },
    { 1: "O", 2: "M", 3: "A", 4: "R" },
    { 1: "F", 2: "A", 3: "D", 4: "I" },
    { 1: "H", 2: "A", 3: "N", 4: "I" },
    { 1: "L", 2: "I", 3: "N", 4: "A" },
    { 1: "N", 2: "I", 3: "D", 4: "A" },
    { 1: "Y", 2: "A", 3: "R", 4: "A" },
    { 1: "H", 2: "A", 3: "L", 4: "A" },
    { 1: "N", 2: "O", 3: "O", 4: "R" },
    { 1: "Z", 2: "I", 3: "A", 4: "D" },
    { 1: "S", 2: "A", 3: "F", 4: "A" },
    { 1: "Z", 2: "I", 3: "N", 4: "A" },
    { 1: "M", 2: "U", 3: "N", 4: "A" },
    { 1: "H", 2: "U", 3: "D", 4: "A" },
    { 1: "J", 2: "O", 3: "U", 4: "D" },
    { 1: "S", 2: "A", 3: "M", 4: "I" },
    { 1: "W", 2: "A", 3: "F", 4: "A" },
    { 1: "L", 2: "A", 3: "M", 4: "A" },
];

const names3 = [
    { 1: "A", 2: "M", 3: "I", 4: "N", 5: "A" },
    { 1: "S", 2: "A", 3: "M", 4: "I", 5: "R" },
    { 1: "L", 2: "A", 3: "Y", 4: "L", 5: "A" },
    { 1: "S", 2: "A", 3: "L", 4: "M", 5: "A" },
    { 1: "M", 2: "A", 3: "J", 4: "I", 5: "D" },
    { 1: "R", 2: "A", 3: "N", 4: "I", 5: "A" },
    { 1: "T", 2: "A", 3: "M", 4: "E", 5: "R" },
    { 1: "Z", 2: "A", 3: "H", 4: "R", 5: "A" },
    { 1: "H", 2: "A", 3: "W", 4: "R", 5: "A" },
    { 1: "F", 2: "A", 3: "W", 4: "Z", 5: "I" },
    { 1: "S", 2: "A", 3: "H", 4: "A", 5: "R" },
    { 1: "A", 2: "M", 3: "M", 4: "A", 5: "R" },
    { 1: "A", 2: "N", 3: "W", 4: "A", 5: "R" },
    { 1: "S", 2: "A", 3: "L", 4: "E", 5: "H" },
    { 1: "A", 2: "Y", 3: "M", 4: "A", 5: "N" },
    { 1: "J", 2: "A", 3: "B", 4: "I", 5: "R" },
    { 1: "A", 2: "D", 3: "N", 4: "A", 5: "N" },
    { 1: "F", 2: "I", 3: "R", 4: "A", 5: "S" },
    { 1: "Z", 2: "A", 3: "Y", 4: "E", 5: "D" },
    { 1: "S", 2: "I", 3: "H", 4: "A", 5: "M" },
    { 1: "A", 2: "Z", 3: "Z", 4: "A", 5: "M" },
    { 1: "H", 2: "A", 3: "N", 4: "A", 5: "N" },
];

const foods1 = [
    { 1: "N", 2: "U", 3: "T" },
    { 1: "E", 2: "G", 3: "G" },
    { 1: "T", 2: "E", 3: "A" },
    { 1: "H", 2: "A", 3: "M" },
    { 1: "P", 2: "I", 3: "E" },
    { 1: "J", 2: "A", 3: "M" },
    { 1: "O", 2: "I", 3: "L" },
    { 1: "F", 2: "I", 3: "G" },
    { 1: "R", 2: "Y", 3: "E" },
    { 1: "O", 2: "A", 3: "T" },
    { 1: "P", 2: "E", 3: "A" },
    { 1: "G", 2: "U", 3: "M" },
    { 1: "B", 2: "U", 3: "N" },
    { 1: "W", 2: "O", 3: "K" },
    { 1: "D", 2: "I", 3: "P" },
    { 1: "I", 2: "C", 3: "E" },
];

const foods2 = [
    { 1: "C", 2: "A", 3: "K", 4: "E" },
    { 1: "R", 2: "I", 3: "C", 4: "E" },
    { 1: "P", 2: "I", 3: "T", 4: "A" },
    { 1: "F", 2: "I", 3: "S", 4: "H" },
    { 1: "S", 2: "O", 3: "U", 4: "P" },
    { 1: "B", 2: "E", 3: "A", 4: "N" },
    { 1: "T", 2: "A", 3: "C", 4: "O" },
    { 1: "C", 2: "O", 3: "R", 4: "N" },
    { 1: "M", 2: "I", 3: "L", 4: "K" },
    { 1: "T", 2: "U", 3: "N", 4: "A" },
    { 1: "K", 2: "I", 3: "W", 4: "I" },
    { 1: "B", 2: "E", 3: "E", 4: "T" },
    { 1: "L", 2: "A", 3: "M", 4: "B" },
    { 1: "C", 2: "O", 3: "R", 4: "N" },
    { 1: "L", 2: "I", 3: "M", 4: "E" },
    { 1: "S", 2: "A", 3: "L", 4: "T" },
    { 1: "T", 2: "A", 3: "C", 4: "O" },
    { 1: "T", 2: "A", 3: "R", 4: "O" },
    { 1: "B", 2: "E", 3: "E", 4: "F" },
    { 1: "S", 2: "O", 3: "D", 4: "A" },
];

const foods3 = [
    { 1: "A", 2: "P", 3: "P", 4: "L", 5: "E" },
    { 1: "M", 2: "A", 3: "N", 4: "G", 5: "O" },
    { 1: "P", 2: "A", 3: "S", 4: "T", 5: "A" },
    { 1: "C", 2: "H", 3: "I", 4: "L", 5: "I" },
    { 1: "O", 2: "L", 3: "I", 4: "V", 5: "E" },
    { 1: "S", 2: "U", 3: "S", 4: "H", 5: "I" },
    { 1: "B", 2: "R", 3: "E", 4: "A", 5: "D" },
    { 1: "B", 2: "A", 3: "C", 4: "O", 5: "N" },
    { 1: "C", 2: "A", 3: "N", 4: "D", 5: "Y" },
    { 1: "P", 2: "I", 3: "Z", 4: "Z", 5: "A" },
    { 1: "J", 2: "U", 3: "I", 4: "C", 5: "E" },
    { 1: "S", 2: "A", 3: "L", 4: "A", 5: "D" },
    { 1: "S", 2: "T", 3: "E", 4: "A", 5: "K" },
    { 1: "L", 2: "E", 3: "M", 4: "O", 5: "N" },
    { 1: "P", 2: "E", 3: "A", 4: "C", 5: "H" },
    { 1: "B", 2: "E", 3: "R", 4: "R", 5: "Y" },
    { 1: "O", 2: "N", 3: "I", 4: "O", 5: "N" },
    { 1: "C", 2: "H", 3: "I", 4: "P", 5: "S" },
    { 1: "P", 2: "R", 3: "A", 4: "W", 5: "N" },
    { 1: "C", 2: "R", 3: "E", 4: "P", 5: "E" },
    { 1: "D", 2: "O", 3: "U", 4: "G", 5: "H" },
];


const animalsCategoryData = {
    animals1: animals1,
    animals2: animals2,
    animals3: animals3,
};

const namesCategoryData = {
    names1: names1,
    names2: names2,
    names3: names3,
};

const foodsCategoryData = {
    foods1: foods1,
    foods2: foods2,
    foods3: foods3,
};

let level = 1;
let letters = [];
let shuffledLetters = [];
let prevWords = [];
let wordcount = 0;
let selectedCategory;
let selectedData;
let correctWord = "";

let soundPlayed = false;
const correctSound = new Audio("audio/correct.mp3");
const wrongSound = new Audio('audio/wrong.mp3');
const winSound = new Audio('audio/win.mp3');
const crowdSound = new Audio('audio/crowd.mp3');
const loseSound = new Audio('audio/lose.mp3');
const timesUpSound = new Audio('audio/timesUp.mp3');


const place = document.querySelector(".letters");
const submit = document.querySelector(".submit-button");
const userWord = document.querySelector(".word-input");
const count = document.querySelector(".count");
const resetButton = document.querySelector(".reset");
const timerDisplay = document.querySelector(".timer");
const spanLevel = document.querySelector(".level");

function getCategory() {
    selectedCategory = localStorage.getItem('selectedCategory') + level;
    if (selectedCategory === "animals" + level) {
        selectedData = animalsCategoryData[selectedCategory];
    }
    else if (selectedCategory === "names" + level) {
        selectedData = namesCategoryData[selectedCategory];
    }
    else {
        selectedData = foodsCategoryData[selectedCategory];
    }

}

function init() {
    place.innerHTML = "";
    letters = [];
    correctWord = "";
}

function render() {
    letters = [];
    prevWords = [];
    wordcount = 0;
    userWord.value = "";
    userWord.classList.remove("wrong-input");
    timerDisplay.classList.remove("low-time");
    timesUpSound.pause();
    count.textContent = `${wordcount}/5`;
    init();
    randomWord();
    clearInterval(timerInterval);
    startTimer();
    selectedCategory = null;
}

function startTimer() {
    timeLeft = 90;
    timerInterval = setInterval(updateTimer, 1000);
}
startTimer();

function updateTimer() {
    if (timeLeft <= 0) {
        timerDisplay.textContent = "0";
        timesUpSound.pause();

        if (!soundPlayed) {
            loseSound.loop = false;
            loseSound.play();
            soundPlayed = true;
        }

        init();
        const timesUpButton = document.createElement("button");
        timesUpButton.classList.add("times-up");
        timesUpButton.textContent = "Time's up! You didn't complete the level. Don't Give Up, TRY again!";
        place.appendChild(timesUpButton);

        timesUpButton.addEventListener("click", () => {
            soundPlayed = false;
            render();
        })
    }
    else {
        if (timeLeft <= 10) {
            timesUpSound.play();
            timerDisplay.classList.add("low-time")
        }
        timerDisplay.textContent = timeLeft;
        timeLeft--;
    }
}


function shuffleArray(array) {
    for (let i = array.length - 1; i >= 0; i--) {
        const randomIndex = Math.floor(Math.random() * (i + 1));
        let shuffle = array[i];
        array[i] = array[randomIndex];
        array[randomIndex] = shuffle;
    }
    return array;
}

function randomWord() {
    getCategory();

    isDuplicate = true;
    while (isDuplicate) {
        const randomIndex = Math.floor(Math.random() * selectedData.length);
        const selectedWord = selectedData[randomIndex];
        init();

        for (let key in selectedWord) {
            letters.push(selectedWord[key]);
        }

        for (let i = 0; i < letters.length; i++) {
            correctWord = correctWord + letters[i];
        }

        isDuplicate = prevWords.includes(correctWord);
    }
    console.log(correctWord);
    prevWords.push(correctWord);
    displaingLetters();
}

function displaingLetters() {
    shuffledLetters = [...letters];
    shuffledLetters = shuffleArray(shuffledLetters);

    for (let i = 0; i < 1000; i++) {
        let stringShuffledLetters = "";

        for (let k = 0; k < letters.length; k++) {
            stringShuffledLetters = stringShuffledLetters + shuffledLetters[k];
        }

        if (correctWord !== stringShuffledLetters) {
            break;
        }
        else {
            shuffledLetters = shuffleArray(shuffledLetters);
        }
    }

    for (let i = 0; i < shuffledLetters.length; i++) {
        const span = document.createElement("span");
        span.classList.add("letter");
        span.textContent = shuffledLetters[i];
        place.appendChild(span);
    }
}
randomWord();

function game() {
    if (userWord.value.toUpperCase() === correctWord) {
        wordcount++;
        count.textContent = `${wordcount}/5`;
        userWord.value = "";
        correctSound.play();

        if (wordcount === 5) {
            init();
            clearInterval(timerInterval);

            const levelCompletedButton = document.createElement("button");
            levelCompletedButton.classList.add("levelCompletedButton");
            
            if (level === 3) {
                if (!soundPlayed) {
                    crowdSound.loop = false;
                    crowdSound.play();
                    soundPlayed = true;
                }  
                levelCompletedButton.textContent = "Congratulations! You completed this Category, TRY anther Category!";
                place.appendChild(levelCompletedButton);

                levelCompletedButton.addEventListener("click", () => {
                    soundPlayed = false;
                    window.location.href = "categoriesPage.html";
                });    
            }
            else {
                level++;
                if (!soundPlayed) {
                    winSound.loop = false;
                    winSound.play();
                    soundPlayed = true;
                }

                levelCompletedButton.textContent = "Congratulations! You completed this level, GO to next Level!";
                place.appendChild(levelCompletedButton);

                levelCompletedButton.addEventListener("click", () => {
                    soundPlayed = false;
                    spanLevel.textContent = `Level ${level}`;
                    render();
                    getCategory();
                });    
            }
        }
        else {
            randomWord();
        }
        
        userWord.classList.remove("wrong-input");
    }
    else {
        userWord.classList.add("wrong-input");
        userWord.value = "";
        wrongSound.play();
    }
}

submit.addEventListener("click", game)
resetButton.addEventListener("click", render)